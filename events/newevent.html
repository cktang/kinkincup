<!DOCTYPE html>
<html ng-app='m'>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.13/angular.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.1/ui-bootstrap-tpls.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Oswald:400,700,300' rel='stylesheet' type='text/css'>	
	<link href="css/style.css" rel="stylesheet">
	<meta name="apple-mobile-web-app-capable" content="yes">

	<script src="https://cdn.firebase.com/js/client/2.2.2/firebase.js"></script>
	<script src="https://cdn.firebase.com/libs/angularfire/1.0.0/angularfire.min.js"></script>

	<Script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js"></script>
	<Script src="js/angular-underscore.js"></script>
</head>

<body ontouchstart="" ng-controller="controller">
	<div class="headerplaceholder" ng-include="'header.html'"></div>
	<div class="footerplaceholder" ng-include="'footer.html'"></div>

	<style>
		h4.btn, h6.btn {
			background-color: #eee;
		}

		.dashboard .btn {
			height: 100px;
			font-size: 20px;
			border: 0px solid silver;
			border-radius: 5px;
			background-color: #eee;
			position:relative;
			padding:10px;
			margin:10px;
		}

		.dashboard .icon {
			position:absolute;
			left: 5px;
			opacity: 0.3;
		}

		.dashboard .col-xs-10 {
			 width:332px
		}

		.dashboard .main {
			line-height:75px;
		}

		.dashboard .badge {
			vertical-align: super;
		}

		.dashboard .sub {
			float:right;
			width:30%;
			font-size: 12px;
		}

		.dashboard .sub .badge {
			font-size: 8px;
			font-weight: normal;
		}

		.dashboard .new {
			border: 5px dotted silver;
		}

		#form2 .field {
			width: 40%;
			margin-right: 10%;
			float:left;
		}

		#form2 .choice {
			border-bottom: 1px solid silver;
			padding: 5px;
		}

		#form3 .field {
			width:80%;
		}
	</style>

	<div class="container">	
      	<h4 class="btn" modal="form1" ng-class="{good:name, bad:!name}"> 
      		{{newEvent.name || 'Event Name ???'}}
			<Br>
			<small>{{newEvent.description || 'Event Description ???'}}</small>
		</h4>

		<div class="row dashboard">
		  <div class="col-xs-10 btn" ng-class="{good:times.length > 0, bad:times.length <= 0}" modal="form2"> 
		  	<span class="icon"><img src="img/calendar.png"/></span>
		  	<span class="main">
		  		Time ???
		  	</span>
		  </div>
		  <div class="col-xs-5 btn" ng-class="{good:venues.length > 0, bad:venues.length <= 0}" modal="form3">
		  	<span class="icon"><img src="img/location.png"/></span>
		  	<span class="main">
		  		Venue ???
		  	</span>
		  </div>
		  <div class="col-xs-5 btn" 
		  	ng-class="{good: _(users).filter({ selected: true }).length > 0, bad:_(users).filter({ selected: true }).length <= 0}" modal="form4">
		  	<span class="icon"><img src="img/running.png"/></span>
		  	<span class="main">
		  		Participants ???
		  	</span>
		  </div>
		  <div class="col-xs-10 btn new" modal="form5">
		  	<span class="main"> Gift?? Reminder??? Travel Tips?? </span>
		  </div>
		</div>

		<hr>
		<button ng-click="addEvent()" class="btn btn-block btn-warning"> Submit </button>

		<!-- Modal -->
		<div class="modal fade" id="form1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">New Event</h4>
		      </div>
		      <div class="modal-body">
		      	  <div class="form-group">
				    <label for="name">Name</label>
				    <input type="text" class="form-control" placeholder="Event Name" ng-model="newEvent.name">
				  </div>
				  <div class="form-group">
				    <label for="description">Description</label>
				    <textarea type="description" class="form-control" placeholder="Event Description" ng-model="newEvent.description"></textarea>
				  </div>		      	
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-primary" data-dismiss="modal">Confirm</button>
		      </div>
		    </div>
		  </div>
		</div> 

		<!-- Modal -->
		<div class="modal fade" id="form2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">Time</h4>
		      </div>
		      <div class="modal-body">
		      	<div ng-repeat="t in times">
		      	<div class="choice">
			        <button type="button" class="close" ng-click="r(times, $index)"><i class="glyphicon glyphicon-remove"></i></button>

		      	  <div class="form-group field">
					    <label for="date">Date</label>

			            <p class="input-group">
			              <input type="text" class="form-control" is-open="opened" ng-model="t.date"/>
			              <span class="input-group-btn">
			                <button type="button" class="btn btn-default" ng-click="opened = !opened">
			                	<i class="glyphicon glyphicon-calendar"></i>
			                </button>
			              </span>
			            </p>	
       			  </div>
				  <div class="form-group field">
				    <label for="time">Time</label>
					<timepicker ng-model="t.time"></timepicker>
				  </div>		      	
					<div style="clear:both; margin:5px"></div>
				</div>
				</div>

				<div> <button class="btn btn-primary" ng-click="p(times)"><i class="glyphicon glyphicon-plus"></i></button> </div>

		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
		        <button type="button" class="btn btn-primary">Confirm</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!-- Modal -->
		<div class="modal fade" id="form3" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">Venues</h4>
		      </div>
		      <div class="modal-body">
		      	<div ng-repeat="v in venues">
		      	<div class="choice">
			        <button type="button" class="close" ng-click="r(venues, $index)"><i class="glyphicon glyphicon-remove"></i></button>

		      	  <div class="form-group field">
			            <input type="text" class="form-control" ng-model="v.name"/>
       			  </div>
				  <div style="clear:both; margin:5px"></div>
				</div>
				</div>

				<div> <button class="btn btn-primary" ng-click="p(venues)"><i class="glyphicon glyphicon-plus"></i></button> </div>

		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
		        <button type="button" class="btn btn-primary">Confirm</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!-- Modal -->
		<div class="modal fade" id="form4" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">Participants</h4>
		      </div>
		      <div class="modal-body" style="padding-top:0px; padding-bottom:0px">
				  <h5 	ng-repeat="u in users" 
				  		class="full" 
				  		style="border-bottom:1px solid silver" 
				  		ng-click="u.selected = !u.selected" 
				  		ng-class="{'label-success': u.selected}">
				  	<span ng-show="u.selected"><i class="pull-right glyphicon glyphicon-ok"></i></span> 
				  	<span>{{u.name}}</span>
				  </h5>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
		        <button type="button" class="btn btn-primary">Confirm</button>
		      </div>
		    </div>
		  </div>
		</div>

		<!-- Modal -->
		<div class="modal fade" id="form5" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">Topic</h4>
		      </div>
		      <div class="modal-body">
		      	  <div class="form-group">
				    <label for="name">Name</label>
				    <input type="text" class="form-control" placeholder="Topic Name" ng-model="name">
				  </div>
				  <div class="form-group">
				    <label for="description">Description</label>
				    <textarea type="description" class="form-control" placeholder="Topic Description" ng-model="description"></textarea>
				  </div>	
				  <div class="form-group">
				    <label for="description">Type</label>
				    <select class="form-control" ng-model="type">
					    <option selected> Vote </option>
					    <option > List </option>
				    </select>
				  </div>	
				  <div class="form-group">
				    <label for="description">Choices</label>
					<div> <button class="btn btn-primary"><i class="glyphicon glyphicon-plus"></i></button> </div>
				  </div>		      	
				  <div class="form-group">
				    <label for="description">List</label>
					<div> <button class="btn btn-primary"><i class="glyphicon glyphicon-plus"></i></button> </div>
				  </div>		      	
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
		        <button type="button" class="btn btn-primary">Confirm</button>
		      </div>
		    </div>
		  </div>
		</div>

		<script>
			$('[modal]').click(function() {
				$('#' + $(this).attr('modal')).modal();
			})

			/*$('[modal=form1]').click();*/
		</script>

		<div class="bottomplaceholder"></div>
	</div>

	
	<script>
		var app = angular
					.module("m", ["firebase", 'ui.bootstrap', 'angular-underscore'])
					.controller("controller", 
						function($scope, $firebaseArray, $window) {
						    $scope.users = $firebaseArray(new Firebase("https://eventshk.firebaseio.com/user"));
						    $scope.events = $firebaseArray(new Firebase("https://eventshk.firebaseio.com/event"));

							$scope.times = [];
							$scope.venues = [];
							$scope.participants = [];

							$scope.addEvent = function() {
								if (!$scope.newEvent || !$scope.newEvent.name || !$scope.newEvent.description) {
									alert('fill in name and description');
									return;
								}

								$scope.events.$add($scope.newEvent).then(function(response) {
									alert('event created!');
									$scope.goto(response.key());
								});
							}

							$scope.p = function(arr) {
								arr.push({});
							}
							
							$scope.r = function(arr, $index) {
								arr.splice($index, 1);
							}	

							$scope.goto = function(id) {
								var url = "eventsummary.html?id=" + id;
								try {
		  							linkEvent(url);
								} catch (e) {
		  							$window.location.href = url;
	  							}
	  						}

						}
					);
	</script>
</body>
</html>
