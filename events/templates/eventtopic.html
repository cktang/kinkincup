<div style="margin-top:20px">
  <div class="ui inverted dimmer" ng-class="{active: !topicLoaded}">
    <div class="ui text loader">Loading</div>
  </div>

  <div ng-show="topicLoaded && !topic.name">
    <div class="ui small fluid teal button" ng-click="$window.history.back()"> Go Back </div>
  </div>

  <div ng-show="!topicLoaded || (topicLoaded && topic.name)">
    <div style="float: right" class="tools">
      <button class="ui circular button" ng-click="goto('chat/' + topic.$id + '/type/topic')"><i class="ui comment icon"/></button>
      <button class="ui circular button" ng-click="newChoice=''; openNewChoiceModal()"><i class="ui plus icon"/></button>
      <div class="ui button" ng-show="topic.finalize" ng-click="unfinalize(topic)">Un-Finalize</div>
      <div class="ui circular button" ng-click="deleteTopic(topic)"><i class="ui delete icon"/></div>
    </div>

    <div class="ui header">
      {{topic.name}} {{decision}}
      <div class="sub header" ng-bind="topic.description"></div>
    </div>

    <style>
      .dim {
        opacity: 0.5;
      }

      .finalized {
        font-weight: bolder;
      }

      .topic {
        min-height: 4em;
        position:relative;
        top: 0px !important;
        font-size: 18px !important;
      }

      .topic .ui.segment {
      	padding: 0.4em !important;
      	background-color: transparent;
      }

      .topic .pre {
        margin-left: -100px;
      }

      .topic .post {
        margin-left: 100%;
      }

      .topic .pre .ui.button, .topic .post .ui.button {
        width: 100%;
        height: 100%;
        border-radius: 0px;
      }

      .topic .part {
        position:absolute;
        top: 0px;
        width: 100px;
        height: 100%;
      }

      .topic .finalizeButton {
        position: absolute;
        right: 0.2em;
      }
    </style>

    <div class="topics" style="overflow:hidden">
    	<div ng-repeat="c in topic.choices"
    		class="ui vertical segment topic"
        topic="{{topic.$id}}"
        choice="{{c}}"
    		ng-class="{ 'finalized green inverted': topic.finalize == c,
                    'dim': topic.finalize && topic.finalize != c }">

        <span class="pre part">
          <button class="ui green button">
            <i class="big checkmark icon"></i>
          </button>
        </span>

        <span style="width: 100%">
          <button class="circular ui mini icon green button"  ng-if="voted({topic:topic, choice:c, value:true})">
            <i class="icon checkmark"></i>
          </button>

          <button class="circular ui mini icon red button"  ng-if="voted({topic:topic, choice:c, value:false})">
            <i class="icon remove"></i>
          </button>

      		<span ng-bind="c"></span>

      		<div class="ui right floated medium icon finalizeButton button"
              ng-click="finalize(topic, c, $event)"
              ng-show="!topic.finalize">
      			<i class="ui icon lock"></i>
      		</div>
          <div style="clear:both"></div>

          <div style="width: 100%; margin-top: 0.2em; margin-left: 2em;">
        		<span ng-repeat="userId in _(topic.votes).keys()"
                  ng-if="topic.votes[userId][c]"
                  ng-class="{green:topic.votes[userId][c].value, red:!topic.votes[userId][c].value, basic:userId==local.user.$id}"
                  class="ui label">
                  {{users.$getRecord(userId).name}}: {{topic.votes[userId][c].reason}}
        		</span>
          </div>
        </span>

        <span class="post part">
          <button class="ui red button">
            <i class="big remove icon"></i>
          </button>
        </span>
    	</div>

      <div style="clear:both"> &nbsp; </div>
    </div>
  </div>

  <!-- newChoiceModal -->
  <div class="ui modal fade" id="newChoiceModal">
    <div class="ui header">
      <h4 id="myModalLabel">New Choice</h4>
    </div>

    <div class="content">
    	  <div class="form-group">
	    <div class="ui fluid input">
		    <input type="text" class="form-control" placeholder="New Choice" ng-model="newChoice">
		</div>
	  </div>
    </div>
    <div class="ui segment actions">
      <button type="button" class="ui deny button">Cancel</button>
      <button type="button" class="ui blue ok button" ng-click="saveNewChoice(newChoice)">Confirm</button>
    </div>
  </div>

  <!-- newChoiceModal -->
  <div class="ui basic modal fade" id="reasonModal">
    <div class="ui header">
      <h4 id="myModalLabel">Reason</h4>
    </div>

    <div class="content">
    	  <div class="form-group">
	    <div class="ui fluid input">
		    <input type="text" class="form-control" placeholder="Reason" ng-model="reason">
		</div>
	  </div>
    </div>
    <div class="ui segment actions">
      <button type="button" class="ui grey basic cancel button">Cancel</button>
      <button type="button" class="ui green basic ok button">Confirm</button>
    </div>
  </div>
</div>
